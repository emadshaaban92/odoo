<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_picking_form_inherit_l10n_in_edi_stock" model="ir.ui.view">
        <field name="name">delivery.stock.picking.form.inherit.l10n.in.edi.stock</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_cancel']" position="after">
                <field name="picking_type_code" invisible="1"/>
                <field name="country_code" invisible="1"/>
                <field name="l10n_in_has_linked_with_sale_purchase" invisible="1"/>
                <button name="button_l10n_in_edi_create_invoice" string="Create Invoice" type="object"
                    attrs="{'invisible': ['|', '|', '|', '|', '|',
                        ('state', '!=', 'done'),
                        ('is_locked', '=', False),
                        ('picking_type_code', '=', 'internal'),
                        ('l10n_in_related_invoice_id', '!=', False),
                        ('l10n_in_has_linked_with_sale_purchase', '=', False),
                        ('country_code', '!=', 'IN')]}"
                        groups="account.group_account_invoice"/>
                <button name="button_l10n_in_send_ewaybill" string="Create EWayBill" type="object"
                    attrs="{'invisible': ['|', '|', '|', '|',
                        ('state', '!=', 'done'),
                        ('is_locked', '=', False),
                        ('picking_type_code', '=', 'internal'),
                        ('country_code', '!=', 'IN'),
                        ('l10n_in_edi_stock_state', 'not in', (False, 'cancelled'))]}" class="oe_highlight"
                        groups="account.group_account_invoice"/>
                <button name="button_l10n_in_cancel_ewaybill" string="Cancel EWayBill" type="object"
                    attrs="{'invisible': ['|', '|', '|', '|',
                        ('state', '!=', 'done'),
                        ('is_locked', '=', False),
                        ('picking_type_code', '=', 'internal'),
                        ('country_code', '!=', 'IN'),
                        ('l10n_in_edi_stock_state', '!=', 'send')]}"
                        groups="account.group_account_invoice"/>
                <button name="button_l10n_in_extend_ewaybill" string="Extend EWayBill" type="object"
                    attrs="{'invisible': ['|', '|', '|', '|',
                        ('state', '!=', 'done'),
                        ('is_locked', '=', False),
                        ('picking_type_code', '=', 'internal'),
                        ('country_code', '!=', 'IN'),
                        ('l10n_in_edi_stock_state', '!=', 'send')]}"
                        groups="account.group_account_invoice"/>
                <button name="button_l10n_in_update_part_b" string="Update Part-B" type="object"
                    attrs="{'invisible': ['|', '|', '|', '|',
                        ('state', '!=', 'done'),
                        ('is_locked', '=', False),
                        ('picking_type_code', '=', 'internal'),
                        ('country_code', '!=', 'IN'),
                        ('l10n_in_edi_stock_state', '!=', 'send')]}"
                        groups="account.group_account_invoice"/>
                <button name="button_l10n_in_update_transporter" string="Update Transporter" type="object"
                    attrs="{'invisible': ['|', '|', '|', '|',
                        ('state', '!=', 'done'),
                        ('is_locked', '=', False),
                        ('picking_type_code', '=', 'internal'),
                        ('country_code', '!=', 'IN'),
                        ('l10n_in_edi_stock_state', '!=', 'send')]}"
                        groups="account.group_account_invoice"/>
            </xpath>

            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_l10n_in_edi_view_invoice"
                    type="object"
                    class="oe_stat_button"
                    icon="fa-pencil-square-o"
                    attrs="{'invisible': [('l10n_in_related_invoice_id', '=', False)]}">
                        <span attrs="{'invisible': [('picking_type_code', '!=', 'outgoing')]}">
                            Invoice
                        </span>
                        <span attrs="{'invisible': [('picking_type_code', '!=', 'incoming')]}">
                            Vendor Bill
                        </span>
                </button>
            </xpath>
            <xpath expr="//header" position="after">
                <field name="l10n_in_edi_blocking_level" invisible="1"/>
                <div class="alert alert-info" role="alert" style="margin-bottom:0px;"
                    attrs="{'invisible': ['|', ('l10n_in_edi_stock_state', 'not in', ['to_send', 'to_cancel']), ('l10n_in_edi_blocking_level', '!=', False)]}">
                     <div>The transfer will be processed asynchronously by the E-Waybill service</div>
                     <button name="button_retry_l10n_in_edi_stock" type="object" class="oe_link" string="Process now" /> 
                </div>
                <div class="alert alert-danger" role="alert" style="margin-bottom:0px;"
                    attrs="{'invisible': [('l10n_in_edi_blocking_level', '!=', 'error')]}">
                    <div class="o_row">
                        <field name="l10n_in_edi_error_message"/>
                        <button name="button_retry_l10n_in_edi_stock" type="object" class="oe_link" string="Retry"/>
                    </div>
                </div>
                <div class="alert alert-warning" role="alert" style="margin-bottom:0px;"
                    attrs="{'invisible': [('l10n_in_edi_blocking_level', '!=', 'warning')]}">
                    <div class="o_row">
                        <field name="l10n_in_edi_error_message"/>
                        <button name="button_retry_l10n_in_edi_stock" type="object" class="oe_link" string="Retry"/>
                    </div>
                </div>
            </xpath>

            <xpath expr="//notebook" position="inside">
                <page string="E-WayBill" attrs="{'invisible': ['|', ('picking_type_code', 'in', (False, 'internal')), ('country_code', '!=', 'IN')]}">
                    <group>
                        <group string="Invoice Details" attrs="{'invisible': [('picking_type_code', 'not in', ('incoming', 'outgoing'))]}" groups="base.group_no_one">
                            <field name="l10n_in_related_invoice_ids" invisible="1"/>
                            <field name="l10n_in_related_invoice_id" domain="[('id', 'in', l10n_in_related_invoice_ids), ('state', '=', 'posted')]" attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}" options="{'no_create': 1, 'no_edit': 1}"/>
                        </group>
                        <group string="Fiscal Information" attrs="{'invisible': [('l10n_in_related_invoice_id', '!=', False)]}">
                            <field name="l10n_in_fiscal_position_id" attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}"/>
                        </group>
                    </group>
                    <group>
                        <group string="Transaction Details">
                            <field name="l10n_in_edi_stock_state"/>
                            <field name="l10n_in_transaction_type" attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}"/>
                            <field name="l10n_in_type_id"
                                domain="[('parent_type_ids', '=', False),
                                ('allowed_in_supply_type', 'in', (picking_type_code == 'incoming' and 'in' or 'out', 'both'))]"
                                attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}"
                                options="{'no_create': 1, 'no_edit': 1, 'no_open': 1}"/>
                            <field name="l10n_in_subtype_id"
                                domain="[('parent_type_ids', 'in', (l10n_in_type_id)),
                                ('allowed_in_supply_type', 'in', (picking_type_code == 'incoming' and 'in' or 'out', 'both'))]"
                                attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}"
                                options="{'no_create': 1, 'no_edit': 1, 'no_open': 1}"/>
                            <field name="l10n_in_sub_supply_desc" attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}"/>
                        </group>

                        <group string="Transportation Details">
                            <field name="l10n_in_mode" attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}"/>
                            <field name="l10n_in_distance" attrs="{'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))]}"/>
                            <field name="l10n_in_vehicle_type" attrs="{
                                'invisible': [('l10n_in_mode', '!=', '1')],
                                'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))],
                                'required': [('l10n_in_mode', '=', '1')]}"/>
                            <field name="l10n_in_vehicle_no" attrs="{
                                'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))],
                                'invisible':[('l10n_in_mode', '!=', '1')],
                                'required': [('l10n_in_mode', '=', '1')]}"/>
                            <field name="l10n_in_transporter_id" attrs="{
                                'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))],
                                'invisible': [('l10n_in_mode', '!=', '0')],
                                'required': [('l10n_in_mode', '=', '0')]}"
                                domain="[('vat','!=',False),('country_id.code','=','IN')]"/>
                            <field name="l10n_in_transporter_doc_no" attrs="{
                                'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))],
                                'invisible': [('l10n_in_mode', 'not in', ('2', '3', '4'))],
                                'required': [('l10n_in_mode', 'in', ('2', '3', '4'))]}"/>
                            <field name="l10n_in_transporter_doc_date" attrs="{
                                'readonly': [('l10n_in_edi_stock_state', 'in', ('send', 'to_cancel'))],
                                'invisible': [('l10n_in_mode', 'not in', ('2', '3', '4'))],
                                'required': [('l10n_in_mode', 'in', ('2', '3', '4'))]}"/>
                        </group>
                    </group>
                    <group>
                        <group string="Cancellation Information" attrs="{'invisible': [('l10n_in_edi_stock_state', 'not in', ('send', 'to_cancel', 'cancelled'))]}">
                            <field name="l10n_in_edi_cancel_reason_code" attrs="{'readonly': [('l10n_in_edi_stock_state', '=', 'cancelled')]}"/>
                            <field name="l10n_in_edi_cancel_remark" attrs="{'invisible': [('l10n_in_edi_cancel_reason_code', '!=', '4')], 'required': [('l10n_in_edi_cancel_reason_code', '=', '4')], 'readonly': [('l10n_in_edi_stock_state', '=', 'cancelled')]}"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

</odoo>
