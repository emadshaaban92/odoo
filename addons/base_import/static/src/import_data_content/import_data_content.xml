<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ImportDataContent" owl="1">
        <div class="o_import_data_content flex-grow-1 overflow-auto border-start">
            <div t-if="props.previewError" class="border-bottom p-2 bg-light">
                <div class="alert alert-danger mb-0">
                    <p>
                        Import preview failed due to: "
                        <t t-esc="props.previewError" />
                        ".
                    </p>
                    <p>For CSV files, you may need to select the correct separator.</p>
                    <p t-if="props.columns.length > 0">Here is the start of the file we could not import:</p>
                </div>
            </div>
            <div t-if="!props.options.has_headers" class="border-bottom p-0 bg-light">
                <p class="alert alert-info mb-0">
                    If the file contains
                    the column names, Odoo can try auto-detecting the
                    field corresponding to the column. This makes imports
                    simpler especially when the file has many columns.
                </p>
            </div>
            <div t-if="props.importMessages.length > 0" class="border-bottom p-2 bg-light">
                <t t-foreach="props.importMessages" t-as="message" t-key="`${message.lines[0]}-${message_index}`">
                    <p t-att-class="getErrorMessageClass(props.importMessages, message.type, message_index)">
                        <t t-foreach="message.lines" t-as="line" t-key="`${line}-${line_index}`">
                            <b t-esc="line" /><br/>
                        </t>
                    </p>
                </t>
            </div>
            <table t-if="!props.previewError" class="table table-borderless w-100">
                <thead>
                    <tr class="p-3 border-bottom">
                        <td class="fw-bold" style="width: 20%;">File Column</td>
                        <td class="fw-bold" style="width: 20%;">Odoo Field</td>
                        <td class="fw-bold">Comments</td>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="props.columns" t-as="column" t-key="`${column_index}-${column.id}`">
                        <tr class="p-3 border-bottom">
                            <td class="d-flex flex-column user-select-none">
                                <span class="fw-bold text-truncate" t-att-title="column.name">
                                    <span class="text-truncate" t-if="column.name" t-esc="column.name" />
                                    <span t-else="">Untitled</span>
                                </span>
                                <span
                                    t-if="props.options.has_headers"
                                    class="o_import_preview fst-italic small pe-2"
                                    data-tooltip-template="ImportDataContent.tooltip"
                                    t-att-data-tooltip-info="getTooltip(column)"
                                    data-tooltip-position="right"
                                >
                                    <t t-esc="column.preview" />
                                </span>
                            </td>
                            <td>
                                <AdvancedSelect
                                    value="column.fieldInfo"
                                    groups="getGroups(column)"
                                    searchable="true"
                                    onSelect="fieldInfo => this.props.onFieldChanged(column, fieldInfo)"
                                    canClear="this.props.isFieldSet(column)"
                                    onClear="() => this.props.onFieldChanged(column, null)"
                                    togglerClass="column.fieldInfo ? 'ps-1' : ''"
                                >
                                    <t t-if="column.fieldInfo">
                                        <i
                                            class="o_import_field_icon border-end"
                                            t-att-class="'position-absolute d-inline-block o_import_field_icon_' + column.fieldInfo.type"
                                            data-tooltip-template="web.FieldTooltip"
                                            t-att-data-tooltip-info="getTooltipDetails(column.fieldInfo)"
                                        ></i>
                                        <span class="ps-5">
                                            <t t-esc="column.fieldInfo.string" />
                                        </span>
                                    </t>
                                    <span t-else="" class="text-warning">To import, select a field...</span>
                                </AdvancedSelect>
                            </td>
                            <td>
                                <t t-foreach="column.comments" t-as="comment" t-key="comment_index">
                                    <p class="m-0 p-2 alert" t-att-class="getCommentClass(column, comment, comment_index)" t-out="getCommentContent(comment)"></p>
                                </t>
                                <ImportDataColumnError t-if="column.errors.length" errors="column.errors" resultNames="column.resultNames" fieldInfo="column.fieldInfo" />
                                <ImportDataOptions t-if="column.errors.length or column.importOptions" importOptions="column.importOptions" fieldInfo="column.fieldInfo" onOptionChanged="props.onOptionChanged" />
                            </td>
                        </tr>
                    </t>
                </tbody>
            </table>
        </div>
    </t>

    <t t-name="ImportDataContent.dropdownOptionTemplate" owl="1">
        <div t-att-class="`${group.label ? 'ms-3' : ''} ${option.value.required ? 'fw-bolder text-decoration-underline' : ''}`">
            <t t-esc="option.label" />
        </div>
    </t>

    <t t-name="ImportDataContent.tooltip" owl="1">
        <h5 class="border-bottom p-2">Preview</h5>
        <div class="p-2 pt-0 pe-3">
            <p
                t-foreach="lines"
                t-as="line"
                t-key="line_index"
                t-out="line"
                class="mb-0 fs-6"
            ></p>
        </div>
    </t>
</templates>