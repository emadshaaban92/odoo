/** @odoo-module **/

import { Define } from '@mail/define';

export default Define`
    {Record/insert}
        [Record/models]
            Element
        [Element/name]
            root
        [Element/model]
            ChatWindowComponent
        [web.Element/class]
            bg-white
        [web.Element/tabindex]
            0
        [web.Element/data-visible-index]
            @record
            .{ChatWindowComponent/chatWindow}
            .{ChatWindow/visibleIndex}
        [Element/onKeydown]
            {switch}
                @ev
                .{web.KeyboardEvent/key}
            .{case}
                [Tab]
                    {web.Event/preventDefault}
                        @ev
                    {if}
                        @ev
                        .{web.KeyboardEvent/shiftKey}
                    .{then}
                        {ChatWindow/focusPreviousVisibleUnfoldedChatWindow}
                            @record
                            .{ChatWindowComponent/chatWindow}
                    .{else}
                        {ChatWindow/focusNextVisibleUnfoldedChatWindow}
                            @record
                            .{ChatWindowComponent/chatWindow}
                [Escape]
                    {if}
                        {Event/isHandled}
                            @ev
                            ComposerTextInputComponent.closeSuggestions
                    .{then}
                        {break}
                    {if}
                        {Event/isHandled}
                            @ev
                            ComposerViewComponent.closeEmojisPopover
                    .{then}
                        {break}
                    {web.Event/preventDefault}
                        @ev
                    {ChatWindow/focusNextVisibleUnfoldedChatWindow}
                        @record
                        .{ChatWindowComponent/chatWindow}
                    {ChatWindow/close}
                        @record
                        .{ChatWindowComponent/chatWindow}
        [Element/onFocusout]
            {Record/update}
                [0]
                    @record
                    .{ChatWindowComponent/chatWindow}
                [1]
                    [ChatWindow/isFocused]
                        false
        [web.Element/style]
            @record
            .{ChatWindowComponent/chatWindow}
            .{ChatWindow/componentStyle}
            [web.scss/position]
                absolute
            [web.scss/bottom]
                0
            [web.scss/display]
                flex
            [web.scss/flex-flow]
                column
            [web.scss/overflow]
                auto
            {if}
                {Device/isMobile}
                .{isFalsy}
            .{then}
                [web.scss/max-width]
                    100%
                [web.scss/max-height]
                    100%
                [web.scss/width]
                    325
                    px
                {if}
                    @record
                    .{ChatWindowComponent/chatWindow}
                    .{ChatWindow/isFolded}
                .{then}
                    [web.scss/height]
                        {scss/$o-mail-chat-window-header-height}
                {if}
                    @record
                    .{ChatWindowComponent/chatWindow}
                    .{ChatWindow/isFolded}
                    .{isFalsy}
                .{then}
                    [web.scss/height]
                        400
                        px
                {if}
                    @record
                    .{ChatWindowComponent/chatWindow}
                    .{ChatWindow/isFocused}
                .{then}
                    [web.scss/box-shadow]
                        -5px
                        -5px
                        10px
                        {scss/rgba}
                            {scss/$black}
                            0.18
            {if}
                @record
                .{ChatWindowComponent/isFullscreen}
            .{then}
                [web.scss/height]
                    100%
                [web.scss/width]
                    100%
            {if}
                {Device/isMobile}
            .{then}
                [web.scss/position]
                    fixed
            [web.scss/background-color]
                {scss/$o-mail-thread-window-bg}
            [web.scss/border-radius]
                6px
                6px
                0
                0
            [web.scss/box-shadow]
                -5px
                -5px
                10px
                {scss/rgba}
                    {scss/$black}
                    0.09
            [web.scss/outline]
                none
            {scss/selector}
                [0]
                    .o-ComposerViewComponent
                [1]
                    [web.scss/border]
                        0
`;
