/** @odoo-module **/

import { Define } from '@mail/define';

export default Define`
    {Record/insert}
        [Record/models]
            Action
        [Action/name]
            Activity/convertData
        [Action/params]
            data
        [Action/behavior]
            :data2
                {Record/insert}
                    [Record/models]
                        Dict
            {if}
                @data
                .{Dict/hasKey}
                    activity_category
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/category]
                            @data
                            .{Dict/get}
                                activity_category
            {if}
                @data
                .{Dict/hasKey}
                    can_write
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/canWrite]
                            @data
                            .{Dict/get}
                                can_write
            {if}
                @data
                .{Dict/hasKey}
                    create_date
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/dateCreate]
                            @data
                            .{Dict/get}
                                create_date
            {if}
                @data
                .{Dict/hasKey}
                    date_deadline
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/dateDeadline]
                            @data
                            .{Dict/get}
                                date_deadline
            {if}
                @data
                .{Dict/get}
                    chaining_type
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/chainingType]
                            @data
                            .{Dict/get}
                                chaining_type
            {if}
                @data
                .{Dict/hasKey}
                    icon
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/icon]
                            @data
                            .{Dict/get}
                                icon
            {if}
                @data
                .{Dict/hasKey}
                    id
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/id]
                            @data
                            .{Dict/get}
                                id
            {if}
                @data
                .{Dict/hasKey}
                    note
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/note]
                            @data
                            .{Dict/get}
                                note
            {if}
                @data
                .{Dict/get}
                    state
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/state]
                            @data
                            .{Dict/get}
                                state
            {if}
                @data
                .{Dict/hasKey}
                    summary
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/summary]
                            @data
                            .{Dict/get}
                                summary
            {Dev/comment}
                relation
            {if}
                @data
                .{Dict/get}
                    activity_type_id
            .{then}
                {if}
                    @data
                    .{Dict/get}
                        activity_type_id
                    .{isFalsy}
                .{then}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/type]
                                {Record/empty}
                .{else}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/type]
                                {Record/insert}
                                    [Record/models]
                                        ActivityType
                                    [ActivityType/displayName]
                                        @data
                                        .{Dict/get}
                                            activity_type_id
                                        .{Collection/second}
                                    [ActivityType/id]
                                        @data
                                        .{Dict/get}
                                            activity_type_id
                                        .{Collection/first}
            {if}
                @data
                .{Dict/hasKey}
                    create_uid
            .{then}
                {if}
                    @data
                    .{Dict/get}
                        create_uid
                    .{isFalsy}
                .{then}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/creator]
                                {Record/empty}
                .{else}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/creator]
                                {Record/insert}
                                    [Record/models]
                                        User
                                    [User/displayName]
                                        @data
                                        .{Dict/get}
                                            create_uid
                                        .{Collection/second}
                                    [User/id]
                                        @data
                                        .{Dict/get}
                                            create_uid
                                        .{Collection/first}
            {if}
                @data
                .{Dict/hasKey}
                    mail_template_ids
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/mailTemplates]
                            {Field/add}
                                {Record/insert}
                                    [Record/models]
                                        MailTemplate
                                    [MailTemplate/id]
                                        @data
                                        .{Dict/get}
                                            mail_template_ids
                                        .{Dict/get}
                                            id
                                    [MailTemplate/name]
                                        @data
                                        .{Dict/get}
                                            mail_template_ids
                                        .{Dict/get}
                                            name
            {if}
                @data
                .{Dict/hasKey}
                    res_id
                .{&}
                    @data
                    .{Dict/hasKey}
                        res_model
            .{then}
                {Record/update}
                    [0]
                        @data2
                    [1]
                        [Activity/thread]
                            {Record/insert}
                                [Record/models]
                                    Thread
                                [Thread/id]
                                    @data
                                    .{Dict/get}
                                        res_id
                                [Thread/model]
                                    @data
                                    .{Dict/get}
                                        res_model
            {if}
                @data
                .{Dict/hasKey}
                    user_id
            .{then}
                {if}
                    @data
                    .{Dict/get}
                        user_id
                    .{isFalsy}
                .{then}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/assignee]
                                {Record/empty}
                .{else}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/assignee]
                                {Record/insert}
                                    [Record/models]
                                        User
                                    [User/displayName]
                                        @data
                                        .{Dict/get}
                                            user_id
                                        .{Collection/second}
                                    [User/id]
                                        @data
                                        .{Dict/get}
                                            user_id
                                        .{Collection/first}
            {if}
                @data
                .{Dict/hasKey}
                    request_partner_id
            .{then}
                {if}
                    @data
                    .{Dict/get}
                        request_partner_id
                    .{isFalsy}
                .{then}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/requestingPartner]
                                {Record/empty}
                .{else}
                    {Record/update}
                        [0]
                            @data2
                        [1]
                            [Activity/requestingPartner]
                                {Record/insert}
                                    [Record/models]
                                        Partner
                                    [Partner/displayName]
                                        @data
                                        .{Dict/get}
                                            request_partner_id
                                        .{Collection/second}
                                    [Partner/id]
                                        @data
                                        .{Dict/get}
                                            request_partner_id
                                        .{Collection/first}
            @data2
`;
