/** @odoo-module **/

import { Define } from '@mail/define';

export default Define`
    {Record/insert}
        [Record/models]
            Action
        [Action/name]
            MessageViewComponent/getTrackingValues
        [Action/params]
            record
                [type]
                    MessageViewComponent
        [Action/behavior]
            @record
            .{MessageViewComponent/messageView}
            .{MessageView/message}
            .{Message/trackingValues}
            .{Collection/map}
                {Record/insert}
                    [Record/models]
                        Function
                    [Function/in]
                        item
                    [Function/out]
                        :value
                            @item
                        {Record/update}
                            [0]
                                @value
                            [1]
                                [changed_field]
                                    {String/sprintf}
                                        [0]
                                            {Locale/text}
                                                %s:
                                        [1]
                                            @value
                                            .{Dict/get}
                                                changed_field
                        {Dev/comment}
                            Maps tracked field type to a JS formatter.
                            Tracking values are not always stored in the
                            same field type as their origin type.
                            Field types that are not listed here are not
                            supported by tracking in Python.
                            Also see 'create_tracking_values' in Python.
                        {switch}
                            @value
                            .{Dict/get}
                                field_type
                        .{case}
                            [boolean]
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {if}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                            .{then}
                                                {Locale/text}
                                                    Yes
                                            .{else}
                                                {Locale/text}
                                                    No
                                        [new_value]
                                            {if}
                                                @value
                                                .{Dict/get}
                                                    new_value
                                            .{then}
                                                {Locale/text}
                                                    Yes
                                            .{else}
                                                {Locale/text}
                                                    No
                            {Dev/comment}
                                many2one formatter exists but is expecting
                                id/name_get or data object but only the
                                target record name is known in this context.

                                Selection formatter exists but requires
                                knowing all possibilities and they are not
                                given in this context.
                            [char]
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/char}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                        [new_value]
                                            {Format/char}
                                                @value
                                                .{Dict/get}
                                                    new_value
                            [many2one]
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/char}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                        [new_value]
                                            {Format/char}
                                                @value
                                                .{Dict/get}
                                                    new_value
                            [selection]
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/char}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                        [new_value]
                                            {Format/char}
                                                @value
                                                .{Dict/get}
                                                    new_value
                            [date]
                                {if}
                                    @value
                                    .{Dict/get}
                                        old_value
                                .{then}
                                    {Record/update}
                                        [0]
                                            @value
                                        [1]
                                            [old_value]
                                                {Moment/utc}
                                                    @value
                                                    .{Dict/get}
                                                        old_value
                                {if}
                                    @value
                                    .{Dict/get}
                                        new_value
                                .{then}
                                    {Record/update}
                                        [0]
                                            @value
                                        [1]
                                            [new_value]
                                                {Moment/utc}
                                                    @value
                                                    .{Dict/get}
                                                        new_value
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/date}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                        [new_value]
                                            {Format/date}
                                                @value
                                                .{Dict/get}
                                                    new_value
                            [datetime]
                                {if}
                                    @value
                                    .{Dict/get}
                                        old_value
                                .{then}
                                    {Record/update}
                                        [0]
                                            @value
                                        [1]
                                            [old_value]
                                                {Moment/utc}
                                                    @value
                                                    .{Dict/get}
                                                        old_value
                                {if}
                                    @value
                                    .{Dict/get}
                                        new_value
                                .{then}
                                    {Record/update}
                                        [0]
                                            @value
                                        [1]
                                            [old_value]
                                                {Moment/utc}
                                                    @value
                                                    .{Dict/get}
                                                        new_value
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/datetime}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                        [new_value]
                                            {Format/datetime}
                                                @value
                                                .{Dict/get}
                                                    new_value
                            [float]
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/float}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                        [new_value]
                                            {Format/float}
                                                @value
                                                .{Dict/get}
                                                    new_value
                            [integer]
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/integer}
                                                @value
                                                .{Dict/get}
                                                    old_value
                                        [new_value]
                                            {Format/integer}
                                                @value
                                                .{Dict/get}
                                                    new_value
                            [monetary]
                                {Record/update}
                                    [0]
                                        @value
                                    [1]
                                        [old_value]
                                            {Format/monetary}
                                                [0]
                                                    @value
                                                    .{Dict/get}
                                                        old_value
                                                [1]
                                                    undefined
                                                [2]
                                                    [currency]
                                                        {if}
                                                            @value
                                                            .{Dict/get}
                                                                currency_id
                                                        .{then}
                                                            @env
                                                            .{Env/owlEnv}
                                                            .{Dict/get}
                                                                session
                                                            .{Dict/get}
                                                                currencies
                                                            .{Dict/get}
                                                                    @value
                                                                    .{Dict/get}
                                                                        currency_id
                                                        .{else}
                                                            undefined
                                                    [forceString]
                                                        true
                                        [new_value]
                                            {Format/monetary}
                                                [0]
                                                    @value
                                                    .{Dict/get}
                                                        new_value
                                                [1]
                                                    undefined
                                                [2]
                                                    [currency]
                                                        {if}
                                                            @value
                                                            .{Dict/get}
                                                                currency_id
                                                        .{then}
                                                            @env
                                                            .{Env/owlEnv}
                                                            .{Dict/get}
                                                                session
                                                            .{Dict/get}
                                                                currencies
                                                            .{Dict/get}
                                                                    @value
                                                                    .{Dict/get}
                                                                        currency_id
                                                        .{else}
                                                            undefined
                                                    [forceString]
                                                        true
                                [text]
                                    {Record/update}
                                        [0]
                                            @value
                                        [1]
                                            [old_value]
                                                {Format/text}
                                                    @value
                                                    .{Dict/get}
                                                        old_value
                                            [new_value]
                                                {Format/text}
                                                    @value
                                                    .{Dict/get}
                                                        new_value
`;
