/** @odoo-module **/

import { Define } from '@mail/define';

export default Define`
    {Record/insert}
        [Record/models]
            Element
        [Element/name]
            viewImage
        [Element/model]
            AttachmentViewerComponent
        [web.Element/tag]
            img
        [Record/models]
            AttachmentViewerComponent/view
        [Element/onClick]
            {if}
                @record
                .{AttachmentViewerComponent/attachmentViewer}
                .{AttachmentViewer/isDragging}
                .{isFalsy}
            .{then}
                {Dev/comment}
                    Stop propagation of event to prevent closing the dialog.
                {web.Event/stopPropagation}
                    @ev
        [Element/onMousedown]
            {if}
                @record
                .{AttachmentViewerComponent/attachmentViewer}
                .{AttachmentViewer/isDragging}
                .{isFalsy}
                .{&}
                    @ev
                    .{web.MouseEvent/button}
                    .{=}
                        0
            .{then}
                {web.Event/stopPropagation}
                    @ev
                {Record/update}
                    [0]
                        @record
                        .{AttachmentViewerComponent/attachmentViewer}
                    [1]
                        [AttachmentViewer/isDragging]
                            true
                {Record/update}
                    [0]
                        @record
                    [1]
                        [AttachmentViewerComponent/dragstartX]
                            @ev
                            .{web.MouseEvent/clientX}
                        [AttachmentViewerComponent/dragstartY]
                            @ev
                            .{web.MouseEvent/clientY}
        [Element/onScroll]
            {web.Event/stopPropagation}
                @ev
            {if}
                @record
                .{AttachmentViewerComponent/root}
            .{then}
                {if}
                    @ev
                    .{web.ScrollEvent/deltaY}
                    .{>}
                        0
                .{then}
                    {AttachmentViewerComponent/_zoomOut}
                        [0]
                            @record
                        [1]
                            [scroll]
                                true
                .{else}
                    {AttachmentViewerComponent/_zoomIn}
                        [0]
                            @record
                        [1]
                            [scroll]
                                true
        [Element/onLoad]
            {web.Event/stopPropagation}
                @ev
            {Record/update}
                [0]
                    @record
                    .{AttachmentViewerComponent/record}
                [1]
                    [AttachmentViewer/isImageLoading]
                        false
        [web.Element/src]
            @record
            .{AttachmentViewerComponent/record}
            .{AttachmentViewer/imageUrl}
        [web.Element/isDraggable]
            false
        [web.Element/alt]
            {Locale/text}
                Viewer
        [Element/t-key]
            image_
            .{+}
                @record
                .{AttachmentViewerComponent/record}
                .{AttachmentViewer/attachment}
                .{Attachment/id}
        [web.Element/style]
            [web.scss/max-height]
                100%
            [web.scss/max-width]
                100%
            [web.scss/transition]
                transform
                0.3s
                ease
            {AttachmentViewerComponent/getImageStyle}
                @record
`;
