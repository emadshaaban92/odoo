/** @odoo-module **/

import { Define } from '@mail/define';

export default Define`
    {Dev/comment}
        Open the full composer modal.
    {Record/insert}
        [Record/models]
            Action
        [Action/name]
            ComposerView/openFullComposer
        [Action/params]
            record
                [type]
                    ComposerView
        [Action/behavior]
            :attachmentIds
                @record
                .{ComposerView/composer}
                .{Composer/attachments}
                .{Collection/map}
                    {Record/insert}
                        [Record/models]
                            Function
                        [Function/in]
                            attachment
                        [Function/out]
                            @attachment
                            .{Attachment/id}
            :context
                {Record/insert}
                    [Record/models]
                        Object
                    [default_attachment_ids]
                        @attachmentIds
                    [default_body]
                        {Utils/escapeAndCompactTextContent}
                            @record
                            .{ComposerView/composer}
                            .{Composer/textInputContent}
                    [default_is_log]
                        @record
                        .{ComposerView/composer}
                        .{Composer/isLog}
                    [default_model]
                        @record
                        .{ComposerView/composer}
                        .{Composer/activeThread}
                        .{Thread/model}
                    [default_partner_ids]
                        @record
                        .{ComposerView/composer}
                        .{Composer/recipients}
                        .{Collection/map}
                            {Record/insert}
                                [Record/models]
                                    Function
                                [Function/in]
                                    partner
                                [Function/out]
                                    @partner
                                    .{Partner/id}
                    [default_res_id]
                        @record
                        .{ComposerView/composer}
                        .{Composer/activeThread}
                        .{Thread/id}
                    [mail_post_autofollow]
                        true
            :action
                {Record/insert}
                    [Record/models]
                        Object
                    [type]
                        ir.actions.act_window
                    [res_model]
                        mail.compose.message
                    [view_mode]
                        form
                    [views]
                        {Record/insert}
                            [Record/models]
                                Collection
                            {Record/insert}
                                [Record/models]
                                    Collection
                                false
                                form
                    [target]
                        new
                    [context]
                        @context
            :composer
                @record
                .{ComposerView/composer}
            :options
                {Record/insert}
                    [Record/models]
                        Object
                    [on_close]
                        {if}
                            {Record/exists}
                                @composer
                            .{isFalsy}
                        .{then}
                            {break}
                        {Composer/_reset}
                            @composer
                        {if}
                            @composer
                            .{Composer/activeThread}
                        .{then}
                            {Thread/fetchData}
                                [0]
                                    @composer
                                    .{Composer/activeThread}
                                [1]
                                    messages
            @env
            .{Env/owlEnv}
            .{Dict/get}
                bus
            .{Bus/trigger}
                [0]
                    do-action
                [1]
                    [action]
                        @action
                    [options]
                        @options
`;
