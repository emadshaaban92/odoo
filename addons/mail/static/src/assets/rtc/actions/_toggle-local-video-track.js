/** @odoo-module **/

import { Define } from '@mail/define';

export default Define`
    {Record/insert}
        [Record/models]
            Action
        [Action/name]
            Rtc/_toggleLocalVideoTrack
        [Action/params]
            type
                [type]
                    String
                [description]
                    'user-video' (eg: webcam) or 'display' (eg: screen sharing)
            force
                [type]
                    Boolean
            record
                [type]
                    Rtc
        [Action/behavior]
            {if}
                @type
                .{=}
                    user-video
            .{then}
                :sendUserVideo
                    {if}
                        @force
                        .{!=}
                            undefined
                    .{then}
                        @force
                    .{else}
                        @record
                        .{Rtc/sendUserVideo}
                        .{isFalsy}
                {Rtc/_updateLocalVideoTrack}
                    [0]
                        @record
                    [1]
                        @type
                    [2]
                        @sendUserVideo
            {if}
                @type
                .{=}
                    display
            .{then}
                :sendDisplay
                    {if}
                        @force
                        .{!=}
                            undefined
                    .{then}
                        @force
                    .{else}
                        @record
                        .{Rtc/sendDisplay}
                        .{isFalsy}
                {Rtc/_updateLocalVideoTrack}
                    [0]
                        @record
                    [1]
                        @type
                    [2]
                        @sendDisplay
            {if}
                @record
                .{Rtc/currentRtcSession}
                .{isFalsy}
            .{then}
                {break}
            {if}
                @record
                .{Rtc/currentRtcSession}
                .{isFalsy}
            .{then}
                {break}
            {if}
                @record
                .{Rtc/videoTrack}
                .{isFalsy}
            .{then}
                {RtcSession/removeVideo}
                    @record
                    .{Rtc/currentRtcSession}
            .{else}
                {Rtc/_updateExternalSessionTrack}
                    [0]
                        @record
                    [1]
                        @record
                        .{Rtc/videoTrack}
                    [2]
                        @record
                        .{Rtc/currentRtcSession}
                        .{RtcSession/peerToken}
`;
