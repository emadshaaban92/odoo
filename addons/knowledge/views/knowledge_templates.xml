<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <!-- Article Tree layout -->
    <template id="knowledge_article_tree_template" name="Article Tree">
        <section t-if="favourites">
            <div class="h4 mb-0">Favourites</div>
            <ul class="o_tree_favourite m-0 px-0 py-2">
                <li t-foreach="favourites" t-as="favourite"
                    t-attf-class="#{ 'bg-light font-weight-bold' if favourite.id == active_article_id else '' }"
                    t-att-data-article-id="favourite.id">
                    <div class="d-flex">
                        <button class="o_article_icon btn btn-link text-secondary p-0" type="button">
                            <i t-attf-class="fa fa-fw #{favourite.icon}"/>
                        </button>
                        <div class="o_article_name flex-grow-1 text-truncate o_cursor_pointer">
                            <t t-out="favourite.name"/>
                        </div>
                    </div>
                </li>
            </ul>
        </section>

        <section class="o_section" data-section="workspace">
            <div class="o_section_header d-flex h4 mb-0">
                <div class="flex-grow-1 text-truncate">Workspace</div>
                <button class="o_section_create btn btn-link text-secondary rounded p-0" type="button">
                    <i class="fa fa-fw fa-plus"/>
                </button>
            </div>
            <ul class="o_tree m-0 px-0 py-2">
                <t t-call="knowledge.articles_template">
                    <t t-set="articles" t-value="public_articles"/>
                </t>
            </ul>
        </section>

        <section t-if="shared_articles" class="o_section mb-3" data-section="shared">
            <div class="o_section_header d-flex h4 mb-0">
                <div class="flex-grow-1 text-truncate">Shared</div>
            </div>
            <ul class="o_tree m-0 px-0 py-2">
                <t t-call="knowledge.articles_template">
                    <t t-set="articles" t-value="shared_articles"/>
                </t>
            </ul>
        </section>

        <section class="o_section mb-3" data-section="private">
            <div class="o_section_header d-flex h4 mb-0">
                <div class="flex-grow-1 text-truncate">Private</div>
                <button class="o_section_create btn btn-link text-secondary rounded p-0" type="button">
                    <i class="fa fa-fw fa-plus"/>
                </button>
            </div>
            <ul class="o_tree m-0 px-0 py-2">
                <t t-call="knowledge.articles_template">
                    <t t-set="articles" t-value="private_articles"/>
                </t>
            </ul>
        </section>
    </template>

    <template id="articles_template">
        <t t-set="unfolded_articles" t-value="unfolded_articles or []"/>
        <t t-foreach="articles" t-as="article">
            <li t-attf-id="article_#{article.id}" t-att-data-article-id="article.id">
                <div t-attf-class="o_article d-flex #{ 'bg-light font-weight-bold' if article.id == active_article_id else '' }">
                    <button class="o_article_caret btn btn-link text-secondary p-0" type="button">
                        <i t-if="article.child_ids" t-att-class="'align-self-center fa fa-fw fa-caret-' + ('down' if article.id in unfolded_articles else 'right')"/>
                        <!-- TODO SRI: Help ! Find a way to take the same space as if there was a carret icon (instead of pl-3) -->
                        <i t-else="" class="pl-3 align-self-center"/>
                    </button>
                    <div class="btn-group dropdown">
                        <button class="o_article_icon btn btn-link text-secondary p-0" type="button" t-attf-id="o_article_dropdown_#{article.id}" data-toggle="dropdown" aria-expanded="true">
                            <i t-attf-class="fa fa-fw #{article.icon}"/>
                        </button>
                        <div class="o_article_dropdown dropdown-menu p-0" role="menu" t-attf-aria-labelledby="o_article_dropdown_#{article.id}">
                            <i class="fa fa-fw fa-file o_cursor_pointer" data-icon-name="fa-file"/>
                            <i class="fa fa-fw fa-book o_cursor_pointer" data-icon-name="fa-book"/>
                            <i class="fa fa-fw fa-user o_cursor_pointer" data-icon-name="fa-user"/>
                            <i class="fa fa-fw fa-address-book o_cursor_pointer" data-icon-name="fa-address-book"/>
                            <i class="fa fa-fw fa-calendar o_cursor_pointer" data-icon-name="fa-calendar"/>
                            <i class="fa fa-fw fa-code o_cursor_pointer" data-icon-name="fa-code"/>
                            <i class="fa fa-fw fa-car o_cursor_pointer" data-icon-name="fa-car"/>
                            <i class="fa fa-fw fa-comment o_cursor_pointer" data-icon-name="fa-comment"/>
                            <i class="fa fa-fw fa-bullhorn o_cursor_pointer" data-icon-name="fa-bullhorn"/>
                        </div>
                    </div>
                    <div class="o_article_name flex-grow-1 text-truncate o_cursor_pointer">
                        <t t-out="article.name"/>
                    </div>
                    <button class="o_article_create btn btn-link text-secondary p-0" type="button">
                        <i class="fa fa-fw fa-plus"/>
                    </button>
                </div>
                <ul t-if="article.child_ids and article.id in unfolded_articles">
                    <t t-call="knowledge.articles_template">
                        <t t-set="articles" t-value="article.child_ids.sorted('sequence').filtered(lambda child: child.user_has_access)"/>
                    </t>
                </ul>
            </li>
        </t>
    </template>
</data>
</odoo>
