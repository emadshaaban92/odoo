<templates>
    <t t-name="project.ProjectTaskStateSelectionForm" owl="1">
        <div class="o_state_box flex-grow-1 flex-shrink-0 d-flex" 
                t-attf-class="{ #{!state.isStateBoxHighlighted ? 'add_left_pad' : ''}" 
                t-on-mouseenter="onMouseEnterStateBox" 
                t-on-mouseleave="onMouseLeaveStateBox">
            <!-- Here is the additionnal dropdown -->
            <ProjectTaskStateAutoDropdown t-if="state.isStateBoxHighlighted" togglerClass="' btn btn-light d-flex rounded-pill '"
                t-on-mouseenter="onMouseEnterModeSelection" t-on-mouseleave="onMouseLeaveModeSelection">
                <t t-set-slot="toggler">
                        <i class="fa fa-fw fa-plus"/>
                    <!--
                        <button class="o_switch_mode_button btn btn-light rounded-pill text-muted m-0" t-on-mouseenter="onMouseEnterModeSelection" t-on-mouseleave="onMouseLeaveModeSelection">
                            <i class="fa fa-fw fa-plus"/>
                        </button>
                    </div>-->
                </t>
                <t t-foreach="switchModeAvailableOptions" t-as="option" t-key="option[0]">
                    <DropdownItem onSelected="() => this._onClickModeSelection(option[0])">
                        <div class="d-flex align-items-center">
                            <span t-attf-class="fa-fw fa {{ stateIcon(option[0]) }} {{ stateColor(option[0]) }}"/>
                            <span t-attf-class="ms-2 {{ stateColor(option[0]) }}" t-esc="option[1]"/>
                        </div>
                    </DropdownItem>
                </t>
            </ProjectTaskStateAutoDropdown>
                

            <div class="o_state_display d-flex">
                
                
                <t t-if="!isApproval">
                    <button class="o_state_non_approval_button btn oe_highlight rounded-pill" 
                    t-attf-class="{ #{this.props.value == 'done' ? 'btn-success' : 'btn-light border border-dark'} }"
                    t-on-click="onClickState" t-on-mouseenter="onMouseEnterStateButton" 
                    t-on-mouseleave="onMouseLeaveStateButton">
                            <t t-if="this.props.value == 'waiting_normal' || this.props.value == 'waiting_approval'">
                                <span t-if="!state.isStateButtonHighlighted" class="o_status_label ms-1">
                                    <i class="fa fa-fw fa-hourglass"/>
                                    Waiting
                                </span>
                                <span t-else="" class="text-success oe_highlight">
                                    <i class="fa fa-fw fa-check"/>
                                    <t t-out="'Mark Done'"></t>
                                </span>
                            </t>
                            <t t-elif="this.props.value == 'in_progress'">
                                <span t-if="!state.isStateButtonHighlighted">
                                    <t t-out="'In Progress'"></t>
                                </span>
                                <span t-else="" class="text-success oe_highlight">
                                    <i class="fa fa-fw fa-check"/>
                                    <t t-out="'Mark Done'"></t>
                                </span>
                            </t>
                            <t t-else="">
                                <i class="fa fa-fw fa-check"/>
                                Done
                            </t>
                        </button>
                </t>
                <t t-else="">
                    <Dropdown class="toggle_dropdown" togglerClass="`o_state_approval_button btn rounded-pill ${ colorButton[currentValue] }`">
                        <t t-set-slot="toggler">
                                <!--
                                    <span t-attf-class="fa-fw fa {{ stateIcon(currentValue) }} {{ stateColor(currentValue) }}"/>
                                -->
                                <t t-if="this.props.value == 'waiting_normal' || this.props.value == 'waiting_approval'">
                                    <i class="fa fa-fw fa-hourglass"/>
                                    <span class="o_status_label ms-1">
                                        Waiting
                                    </span>
                                </t>
                                <t t-else="">
                                    <span class="o_status_label ms-1" t-esc="label"/>
                                </t>
                        </t>
                        <t t-foreach="availableOptions" t-as="option" t-key="option[0]">
                            <DropdownItem onSelected="() => this._onClickModeSelection(option[0])">
                                <div class="d-flex align-items-center">
                                    <span t-attf-class="fa-fw fa {{ stateIcon(option[0]) }} {{ stateColor(option[0]) }}"/>
                                    <span t-attf-class="ms-2 {{ stateColor(option[0]) }}" t-esc="option[1]"/>
                                </div>
                            </DropdownItem>
                        </t>
                    </Dropdown>
                </t>
            </div>
        </div>
    </t>

</templates>
