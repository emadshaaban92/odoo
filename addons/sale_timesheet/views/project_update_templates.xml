<?xml version="1.0"?>
<odoo>
    <template id="project_update_default_description" inherit_id="project.project_update_default_description">
        <!--As this template is rendered in an html field, the spaces may be interpreted as nbsp while editing. -->
        <xpath expr="//div[@name='milestone']" position="before">
<br/>
<div t-if="show_sold">
<h3 style="font-weight: bolder"><u>Sold</u></h3>
<table class="table table-bordered table-striped">
<tbody>
<thead>
<td style="font-weight: bolder">Service</td>
<td style="font-weight: bolder">Sold</td>
<td style="font-weight: bolder">Effective</td>
<td style="font-weight: bolder">Remaining</td>
</thead>
<tr t-foreach="services['data']" t-as="service">
<t t-set="is_unit" t-value="service['is_unit']"/>
<t t-set="is_hour" t-value="service['is_hour']"/>
<t t-set="unit" t-value="service['unit']"/>
<td t-attf-class="#{ 'fst-italic' if is_unit else ''}"><t t-esc="service['name']"/></td>
<td t-attf-class="#{ 'fst-italic' if is_unit else ''}" style="text-align: right; vertical-align: middle;"><t t-esc="format_value(service['sold_value'], is_hour)"/> <t t-esc="unit"/></td>
<td t-attf-class="#{ 'fst-italic' if is_unit else ''}" style="text-align: right; vertical-align: middle;"><t t-esc="format_value(service['effective_value'], is_hour)"/> <t t-esc="unit"/></td>
<td t-attf-class="#{ 'fst-italic' if is_unit else ''}" style="text-align: right; vertical-align: middle;"><t t-esc="format_value(service['remaining_value'], is_hour)"/> <t t-esc="unit"/></td>
</tr>
<tfoot>
<t t-set="totals" t-value="services['totals']"/>
<t t-set="is_hour" t-value="services['is_hour']"/>
<t t-set="company_time_uom" t-value="services['company_time_uom']"/>
<td style="font-weight: bolder; text-align: right">Total<br/> </td>
<td style="font-weight: bolder; text-align: right; vertical-align: middle;">
    <t t-esc="format_value(totals['hours_sold'], is_hour)"/> <t t-esc="company_time_uom"/><br/>
    <div class="fst-italic"><t t-esc="format_value(totals['units_sold'], False)"/> Units</div>
</td>
<td style="font-weight: bolder; text-align: right; vertical-align: middle;">
    <t t-esc="format_value(totals['hours_effective'], is_hour)"/> <t t-esc="company_time_uom"/><br/>
    <div class="fst-italic"><t t-esc="format_value(totals['units_effective'], False)"/> Units</div>
</td>
<td style="font-weight: bolder; text-align: right; vertical-align: middle;">
    <t t-esc="format_value(totals['hours_remaining'], is_hour)"/> <t t-esc="company_time_uom"/><br/>
    <div class="fst-italic"><t t-esc="format_value(totals['units_remaining'], False)"/> Units</div>
</td>
</tfoot>
</tbody>
</table>
<br/>
</div>

<div name="profitability" t-if="show_profitability">
<t t-if="project.analytic_account_id and project.allow_billable and user.has_group('project.group_project_manager')" name="costs">
<h3 style="font-weight: bolder"><u>Profitability</u></h3>
<t t-if="project.allow_billable">
The cost of the project is now at <t t-esc="profitability['costs_formatted']"/>, for a revenue of <t t-esc="profitability['revenues_formatted']"/>, leading to a
<span>
<font t-if="profitability['margin'] &gt; 0"  style="color: rgb(0, 128, 0)">
<b><t t-esc="profitability['margin_formatted']"/></b>
</font>
<font t-elif="profitability['margin'] &lt; 0" style="color: rgb(128, 0, 0)">
<b><t t-esc="profitability['margin_formatted']"/></b>
</font>
<t t-else="" t-esc="profitability['margin_formatted']"/>
</span> margin (<t t-esc="profitability['margin_percentage']"/>%).
</t>
</t>
</div>
        </xpath>
    </template>

</odoo>
